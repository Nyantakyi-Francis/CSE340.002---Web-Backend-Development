<% if (title) { %>
    <h1>
        <%= title %>
    </h1>
    <% } else { res.redirect('/') } %>

        <%- messages() %>

            <%# The Vehicle Detail Display %>
                <%- detail %>

                    <!-- Reviews Section -->
                    <div class="reviews-section">
                        <h2>Customer Reviews</h2>

                        <% if (reviewCount> 0) { %>
                            <div class="rating-summary">
                                <span class="average-rating">
                                    <%= averageRating %>
                                </span>
                                <span class="rating-stars">
                                    <%= utilities.buildStarRating(averageRating) %>
                                </span>
                                <span class="review-count">(<%= reviewCount %>
                                        <%= reviewCount===1 ? 'review' : 'reviews' %>)</span>
                            </div>
                            <% } %>

                                <!-- Review Form (only for logged-in users) -->
                                <% if (locals.loggedin) { %>
                                    <div class="review-form-container">
                                        <h3>Write a Review</h3>
                                        <form action="/review/add" method="post" class="review-form">
                                            <input type="hidden" name="inv_id" value="<%= inv_id %>">
                                            <input type="hidden" name="account_id"
                                                value="<%= locals.accountData.account_id %>">

                                            <div class="form-group">
                                                <label>Rating:</label>
                                                <div class="star-rating">
                                                    <input type="radio" id="star5" name="review_rating" value="5"
                                                        required>
                                                    <label for="star5" title="5 stars">★</label>
                                                    <input type="radio" id="star4" name="review_rating" value="4">
                                                    <label for="star4" title="4 stars">★</label>
                                                    <input type="radio" id="star3" name="review_rating" value="3">
                                                    <label for="star3" title="3 stars">★</label>
                                                    <input type="radio" id="star2" name="review_rating" value="2">
                                                    <label for="star2" title="2 stars">★</label>
                                                    <input type="radio" id="star1" name="review_rating" value="1">
                                                    <label for="star1" title="1 star">★</label>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label for="review_text">Your Review:</label>
                                                <textarea id="review_text" name="review_text" rows="4" required
                                                    minlength="10" maxlength="500"
                                                    placeholder="Share your experience with this vehicle (10-500 characters)"></textarea>
                                                <small>Character count: <span id="charCount">0</span>/500</small>
                                            </div>

                                            <button type="submit" class="btn-primary">Submit Review</button>
                                        </form>
                                    </div>
                                    <% } else { %>
                                        <p class="login-prompt">
                                            <a href="/account/login">Log in</a> to write a review
                                        </p>
                                        <% } %>

                                            <!-- Display Reviews -->
                                            <%- utilities.buildReviewsDisplay(reviews) %>
                    </div>

                    <script>
                        // Character counter for review text
                        const reviewText = document.getElementById('review_text');
                        const charCount = document.getElementById('charCount');

                        if (reviewText && charCount) {
                            reviewText.addEventListener('input', function () {
                                charCount.textContent = this.value.length;
                            });
                        }
                    </script>